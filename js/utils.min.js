Math.approx=function(num,places){var p=Math.pow(10,places);return Math.round(num*p)/p};Math.approxFixed=function(num,places){return this.approx(num,places).toFixed(places)};Math.sinDeg=function(deg){return Math.sin(deg/180*Math.PI)};Math.cosDeg=function(deg){return Math.cos(deg/180*Math.PI)};Math.tanDeg=function(deg){return Math.tan(deg/180*Math.PI)};Math.asinDeg=function(val){return Math.asin(val)*(180/Math.PI)};Math.acosDeg=function(val){return Math.acos(val)*(180/Math.PI)};Math.atanDeg=function(val){return Math.atan(val)*(180/Math.PI)};Array.prototype.max=function(){return Math.max.apply(Math,this)};Array.prototype.min=function(){return Math.min.apply(Math,this)};String.prototype.ltrim=function(){return this.replace(/^\s+/,"")};String.prototype.rtrim=function(){return this.replace(/\s+$/,"")};String.prototype.trim=function(){return this.ltrim().rtrim()};String.prototype.despace=function(){return this.trim().replace(/\s+/g," ")};String.prototype.textLength=function(mode){var txt=this.despace();switch(mode){case"alpha":txt=txt.replace(/[^a-z]/gi,"");break;case"alphanum":txt=txt.replace(/[^a-z0-9]/gi,"");break}return txt.length};String.prototype._contains=function(type,str,mode){var rgx,source;if(str.constructor==RegExp){switch(mode){case"word":case"f":case"fuzzy":case"smart":case"regex":default:mode="f";break}var ar=str.toString().split("/");str=ar.length>0?ar[1]:""}if(typeof str!="string"){str=""}switch(mode){case"i":case"t":case"trim":case"ti":switch(mode){case"i":case"ti":source=this.toLowerCase();str=str.toLowerCase();break;default:source=this;break}switch(mode){case"t":case"ti":case"trim":source=source.trim();break}break;case"f":case"fuzzy":case"smart":case"regex":case"word":var b=mode=="word"?"\\b":"";switch(type){case"start":rgx="^"+str+b;break;case"end":rgx=b+str+"$";break;default:rgx=b+str+b;break}return new RegExp(rgx,"i").test(this);break;default:source=this;break}var index=source.indexOf(str);switch(type){case"start":return index==0;case"end":return index==this.length-str.length;default:return index>=0}return false};String.prototype.startsWith=function(str,mode){return this._contains("start",str,mode)};String.prototype.endsWith=function(str,mode){return this._contains("end",str,mode)};String.prototype.contains=function(str,mode){return this._contains("contain",str,mode)};String.prototype.first=function(separator){return this.split(separator).shift()};String.prototype.last=function(separator){return this.split(separator).pop()};String.prototype.tailHead=function(separator,mode){var parts=this.split(separator),rest="";if(mode=="tail"){parts.shift()}else{parts.pop()}if(parts.length>0){rest=parts.join(separator)}return rest};String.prototype.tail=function(separator){return this.tailHead("tail")};String.prototype.head=function(separator){return this.tailHead("head")};String.prototype.segment=function(index,separator){var parts=this.split(separator),segment="";if(parts.length>index){segment=parts[index]}return segment};String.prototype.sanitize=function(separator){return this.toLowerCase().replace(/[^0-9a-z]+/i,"").replace(/[^0-9a-z]+$/i,"").replace(/[^0-9a-z]+/gi,separator)};String.prototype.numberStrings=function(){return this.replace(/[^0-9.-]+/g," ").trim().split(" ")};String.prototype.toNumberString=function(){return this.numberStrings().shift()};String.prototype.endNumber=function(){var n=-1,ns=this.numberStrings();if(ns.length>0){n=ns.pop()-0}return n};String.prototype.isNumeric=function(allowCommas){var rgx=new RegExp("^\\s*-?\\d+(\\.\\d+)?\\s*$");return rgx.test(this)};function isNumeric(scalarVal){switch(typeof scalarVal){case"number":return!isNaN(scalarVal);case"string":return scalarVal.isNumeric()}}String.prototype.endInt=function(){return Math.abs(parseInt(this.endNumber()))};String.prototype.toInt=function(){var n=this.toNumberString();if(!isNaN(n)){return parseInt(n)}return 0};String.prototype.toFloat=function(){var n=this.toNumberString();if(!isNaN(n)){return parseFloat(n)}return 0};var TextUtils={filterSmallWords:function(word){switch(word.toLowerCase()){case"to":case"the":case"that":case"those":case"this":case"these":case"in":case"on":case"upon":case"over":case"above":case"among":case"between":case"about":case"at":case"of":case"in":case"for":case"and":case"a":case"an":case"from":case"with":case"against":return false;default:return true}}};String.prototype.capitalize=function(smart){var parts=this.split(/\b/),text="",num=parts.length,word,wordLen=0,cast=true;smart=smart?true:false;if(num>0){for(k in parts){word=parts[k];wordLen=word.length;if(wordLen>0){cast=k>0&&smart?TextUtils.filterSmallWords(word):true;if(cast){text+=word.substring(0,1).toUpperCase();if(word.length>1){text+=word.substring(1,wordLen)}}else{text+=word}}}}return text};String.prototype.titleCase=function(smart){return this.capitalize(true)};String.prototype.cleanCommand=function(){return this.split("|").shift().split(">").shift().split("&").shift().split("<").shift()};var Word=function(str){this.letters=str.split("")};Word.prototype.length=function(){return this.letters.length};Word.prototype.get=function(index){var letter="";if(index<this.letters.length){letter=this.letters[index]}return letter};Word.prototype.size=function(){return this.letters.length};Word.prototype.append=function(str){if(str){var letters=str.split("");for(l in letters){this.letters.push(letters[l])}}return this};Word.prototype.toString=function(){return this.letters.join("")};function convertDDToDMS(D,lng){return{dir:D<0?lng?"W":"S":lng?"E":"N",deg:0|(D<0?D=-D:D),min:0|D%1*60,sec:(0|D*60%1*6e3)/100}}function convertDmsToDec(deg,min,sec,dir){var degrees=0;if(isNumeric(deg)){degrees=parseInt(deg)}if(isNumeric(min)){degrees+=parseInt(min)/60}if(isNumeric(sec)){degrees+=parseFloat(sec)/3600}switch(dir){case"S":case"s":case"W":case"w":degrees=0-degrees}return degrees}function toLatLngLabel(coords){return toLatitudeString(coords.lat)+" "+toLatitudeString(coords.lng)}function toLatitudeString(decLat,format){return _toLatLngString(decLat,"lat",format)}function toLongitudeString(decLng,format){return _toLatLngString(decLng,"lng",format)}function toLatLngStr(coords){if(typeof coords=="object"){return toLatitudeString(coords.lat,"plain")+", "+toLongitudeString(coords.lng,"plain")}}var numEntryWidget=function(name,value,decPlaces){return'<input type="number" name="degrees_'+name+'" value="'+value+'" size="3" maxlength=3" />'};function _toLatLngString(dec,degType,format){if(isNumeric(dec)){dec=parseFloat(dec);var isLng=false,max=90;switch(degType){case"lng":case"long":case"longitude":isLng=true;max=180;break}var min=0-max;if(dec>=max){dec-=max*2}else if(dec<=min){dec+=max*2}var strDeg="&deg;",strApos="&apos;",strQuot="&quot;";switch(format){case"plain":strDeg="º";strApos="'";strQuot="”";break}var degree=convertDDToDMS(dec,isLng);return degree.deg+strDeg+" "+degree.min+strApos+" "+degree.sec+strQuot+" "+degree.dir}}var toEuroDate=function(strDate){return strDate.split("-").reverse().join(".")};var zeroPad2=function(num){var isString=typeof num=="string",isNum=typeof num=="number",str;if(isString||isNum){if(isNum||/^\s*\d+\s*$/.test(num)){num=parseInt(num)}if(num<10){str="0"+num}else{str=num.toString()}}return str};var toHourOffsetString=function(hourVal,places){var str="00";if(isNumeric(hourVal)){var absVal=Math.abs(hourVal),flVal=parseFloat(hourVal),isNeg=flVal<0,minVal=flVal%1,hVal=Math.floor(absVal),mVal=minVal*60;if(flVal>0){str="+"}else if(flVal<0){str="-"}else{str=""}if(places!==1){str+=zeroPad2(hVal)}else{str+=hVal}if(minVal>0){str+=":"+zeroPad2(mVal)}}return str};var toSwissEphTime=function(strTime){var parts=strTime.split(":"),t;if(parts.length>1){t=zeroPad2(parts[0])+"."+zeroPad2(parts[1]);console.log(t);if(parts.length>2){t+=zeroPad2(parts[2])}}return t};function objToString(obj){if(typeof obj=="object"){var parts=[],tp;for(var sk in obj){tp=typeof obj[sk];switch(tp){case"string":case"number":parts.push(sk+": "+obj[sk]);break}}return parts.join(", ")}}function localStorageSupported(){try{return"localStorage"in window&&window["localStorage"]!==null}catch(e){return false}}function storeItem(key,data){if(localStorageSupported()){var ts=Date.now()/1e3,sd=ts+":";if(typeof data=="object"){sd+="obj:"+JSON.stringify(data)}else{sd+="sca:"+data}localStorage.setItem(key,sd)}}function getItem(key,maxAge){var ts=Date.now()/1e3,obj={expired:true,valid:false},data=localStorage.getItem(key);if(localStorageSupported()){if(data){parts=data.split(":");if(parts.length>2){obj.ts=parts.shift();obj.ts=obj.ts-0;obj.type=parts.shift();obj.data=parts.join(":");if(obj.type=="obj"){obj.data=JSON.parse(obj.data)}obj.valid=true;if(ts-maxAge>obj.ts){obj.expired=false}}}}return obj}function deleteItem(key){if(localStorageSupported()){if(localStorage.getItem(key)!==null){localStorage.removeItem(key);return true}}return false}var toParamString=function(obj,excludes){var str="",parts=[],excludeKeys=[];if(excludes instanceof Array){excludeKeys=excludes}if(typeof obj=="object"){var keys=Object.keys(obj),len=keys.length,i=0,k;for(;i<len;i++){k=keys[i];if(excludeKeys.indexOf(k)<0){k=keys[i];parts.push(k+"="+obj[k].toString())}}if(parts.length>0){str=parts.join("&")}}return str};var fromParamStr=function(paramStr){var obj={};if(typeof paramStr=="string"){paramStr=paramStr.replace(/^\?/,"");var parts=paramStr.split("&"),numParts=parts.length,i=0,sps,k,v;for(;i<numParts;i++){sps=parts[i].split("=");if(sps.length>1){k=sps[0].replace(/&amp;/,"");v=sps[1];if(v.length>0){obj[k]=v}}}}return obj};var roundDecimal=function(num,decPlaces){if(isNumeric(num)){var m=Math.pow(10,decPlaces);num=parseFloat(num);return parseInt(num*m)/m}};var dateStringFormatted=function(dateStr){var d=new Date(dateStr);return zeroPad2(d.getDate())+"/"+zeroPad2(d.getMonth()+1)+"/"+d.getFullYear()+" "+d.getHours()+":"+d.getMinutes()};countryStringMap={GB:["united kingdom","britain","england","scotland","wales","uk"],US:["united states","usa","america"]};var matchCountry=function(str){var cc="XX",simpleStr=str.trim().toLowerCase().replace(","," ").replace(/\s\s+/," ").split(" "),opts=[],k,i;for(k in countryStringMap){opts=countryStringMap[k];for(i=0;i<opts.length;i++){if(simpleStr.indexOf(opts[i])>=0){return k}}}return cc};var convertFtAndMetres=function(flVal,sourceUnit,change){var obj={unit:sourceUnit,steps:10,m:0,ft:0,display:0,max:9e3};if(isNumeric(flVal)){var mToFt=.3048,intVal=parseInt(flVal);switch(sourceUnit){case"ft":obj.steps=25;if(change===true){obj.m=intVal;obj.ft=Math.ceil(intVal/obj.steps/mToFt)*obj.steps}else{obj.m=parseInt(Math.ceil(intVal*mToFt)/obj.steps)*obj.steps;obj.ft=intVal}obj.max=3e4;obj.display=obj.ft;break;default:obj.steps=10;if(change===true){obj.m=parseInt(Math.ceil(intVal*mToFt)/obj.steps)*obj.steps;obj.ft=intVal}else{obj.ft=Math.ceil(intVal/obj.steps/mToFt)*obj.steps;obj.m=intVal}obj.display=obj.m;break}}return obj};
