
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
    <title>Zodiac</title>
<style>

@import url('/css/style.css') screen;

#main {
    position: relative;
    margin: 0 auto;
}

#snap-pane {
    position: fixed;
    top: 4em;
    left: 0;
    right: 0;
}

#snap-pane.fit-screen svg {
    max-height: 92vh;
}

#main .plus-minus {
    position: absolute;
    top: 4em;
    left: 5%;
    font-size: 2.5rem;
    padding: 0 0.125em 0.25em 0.125em;
    height: 2rem;
    width: 2rem;
    border-radius: 2rem;
    border: solid 2px black;
    cursor: pointer;
    z-index: 100;
}

#snap-pane svg image.body {
    transition: all 1s ease-in;
    transform-origin: 50% 50% 50%;    
}

#snap-pane svg circle {
    transition: all 1s ease-in;
    transform-origin: 50% 50% 50%;    
}

</style>


<script src="//code.jquery.com/jquery-3.1.1.min.js"
  integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
  crossorigin="anonymous"></script>


</head>
<body>

<header id="navbar">
    <h1>astroIQ Demo</h1>
    <nav class="horizontal"><ul>
        <li><a href="/">Command Test</a></li>   
        <li><a href="/zodiac">Zodiac Demo</a></li>
        <li><a href="/snap">Snap Demo</a></li>
    </ul></nav>
</header>
<aside id="control-panel">
    <form id="control-form" action="/sweph" method="post">
        <p>
            <label>Date of birth:</label><input type="date" id="form-dob" name="dob" size="10" value="1961-06-28" />
        </p>
        <p>
            <label>Time of birth:</label><input type="time" id="form-tob" name="tob" size="5" value="11:25"/>
        </p>
        <p>
            <label for="form-geobirth">Place of birth:</label><input type="text" id="form-geobirth" name="geobirth" size="48" value="" /><input type="submit" id="geobirth-finder" value="Find" />
            <div class="hidden" id="geo-address"></div>
        </p>
        <p>
            <label>Co-ordinates (longitude/latitude):</label><input type="text" pattern="[0-9.-]+" id="form-lng" name="lng" size="8" value="-13.6667" /><input type="text" pattern="[0-9.-]+" id="form-lat" name="lat" size="8" value="65.15"/>
        </p>
        <p>
            <label for="form-alt">Altitude (metres):</label><input type="number" id="form-alt" name="alt" size="8" value="30" steps="10" min="0" max="9000"/>
        </p>
        <p>
            <label for="form-hsy">House system:</label><select id="form-hsy" name="hsy">
                <option value="W">Whole house equal</option>
                <option value="E">Equal = A</option>
                <option value="D">Equal / MC</option>
                <option value="S">Sripati (Jyotish)</option>
                <option value="O">Porphyry</option>
                <option value="K">Koch</option>
                <option value="B">Alcabitius</option>
                <option value="C">Campanus</option>
                <option value="M">Morinus</option>
                <option value="P">Placidus</option>
                <option value="H">Horizon / azimuth</option>
                <option value="R">Regiomontanus</option>
                <option value="T">Topocentric</option>
                <option value="A">Equal</option>
                <option value="X">Meridian houses</option>
                <option value="G">36 Gauquelin sectors</option>
            </select>
        </p>
        <p>
            <label for="form-ayanamsa">Ayanamsa</label>
            <select id="form-ayanamsa" name="ayanamsa">
                <option value="-">Tropical</option>
                <option value="1">Lahiri</option>
                <option value="3">Raman</option>
                <option value="4">Ushashashi</option>
                <option value="5">Krishnamurti</option>
                <option value="6">Djwhal Khul</option>
                <option value="7">Yukteshwar</option>
                <option value="8">J.N. Bhasin</option>
                <option value="0">Fagan/Bradley</option>
                <option value="2">De Luce</option>
                <option value="15">Hipparchos</option>
                <option value="16">Sassanian</option>
                <option value="21">Suryasiddhanta</option>
                <option value="22">Suryasiddhanta, mean Sun</option>
                <option value="23">Aryabhata</option>
                <option value="25">SS Citra</option>
                <option value="26">SS Revati</option>
                <option value="27">True Citra</option>
                <option value="28">True Revati</option>
                <option value="29">True Pushya</option>
                <option value="30">Galactic (Gil Brand)</option>
                <option value="34">Skydram (Mardyks)</option>
                <option value="35">True Mula (Chandra Hari)</option>
                <option value="36">Dhruva/Gal.Center/Mula (Wilhelm)</option> 
            </select>
        </p>
        <p class="radios" id="form-mode">
            
             <input type="radio" value="topo" name="mode" id="form-mode-topo" class="mode" checked="true" />
            <label for="form-mode-topo">Topocentric</label>
            <input type="radio" value="geo" name="mode" id="form-mode-geo" class="mode"/>
            <label for="form-mode-geo">Geocentric</label>
        </p>

        <div id="form-actions"><input type="submit" value="Go" id="form-submit" /></div>
    </form>
    
</aside>
<div id="main">
    <div id="results-pane"></div>
    <div class="plus-minus">+</div>
    <object id="snap-pane" class="snap-pane fit-screen">
    
        <?xml version="1.0" encoding="UTF-8"?>
<svg viewBox="0 0 1440 1440" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="zodiac-svg">
   
</svg>

    </object>


</div>
<script data-source="internal" type="text/javascript" src="/js/snap/dist/snap.svg-min.js"></script>
<script data-source="internal" type="text/javascript">
var astroDisc;
(function($) {
    $( document ).ready(function() {

        astroDisc = {
            snap: null,
            radius: 360,
            element: '#zodiac-svg',
            /*houses: [0,30,60,90,120,150,180,210,240,270,300,330],*/
            houses: [152,187,214,237,276,294,321,0,32,65,91,118],
            segments: [],
            bodies: {},
            addSegment: function(fillColor,startDeg,endDeg,index) {
                if (!endDeg) {
                    endDeg = 0;
                }
                if (!startDeg) {
                    startDeg = 0;
                }
                var ed = endDeg > 0? endDeg : endDeg+360
                var r = this.radius, data = this.calcTrianglePoints(startDeg,ed), ps = data.points;
                var bigCircle = this.snap.circle(r,r,r).attr({fill:fillColor}),
                    triangle = this.snap.polygon(ps).attr({
                        fill: "white",
                        "stroke-width":0,
                        class: 'triangle'
                    }); 

                bigCircle.attr({
                    mask: triangle,
                    transform: 'rotate('+(ed-data.span) +'deg)',
                    class: 'segment-disc',
                    'data-start': startDeg,
                    'data-end': ed,
                    'data-span': data.span,  
                });
                this.segments[index] = {
                    triangle: triangle,
                    circle: bigCircle
                };
            },

            updateSegments: function(houses) {
                if (houses instanceof Array) {
                    this.houses = houses;
                    this.loopHouses('update');
                }
            },

            updateSegment: function(index,startDeg,endDeg) {
                if (typeof this.segments[index] == 'object') {
                    var ed = endDeg > 0? endDeg : endDeg+360,
                    data = this.calcTrianglePoints(startDeg,ed);
                    this.segments[index].triangle.attr({
                        points: data.points.join(',')
                    });
                    
                    this.segments[index].circle.attr({
                        mask: this.segments[index].triangle,
                        transform: 'rotate('+(ed-data.span)+'deg)',
                        'data-start': startDeg,
                        'data-end': ed,
                        'data-span': data.span,
                    });
                }
            },

            calcTrianglePoints: function(startDeg,endDeg) {
                var r = this.radius,
                    ps = [r,(0-(r * (5/12))),r,r,((r*2) + (r * (5/12))),r],
                    s1 = Math.abs(ps[1] - ps[3]),
                    spanDeg = endDeg - startDeg,
                    frac = spanDeg / 90,
                    adj = Math.pow((1-frac),.125),
                    sub = s1 * (1-frac) * adj;
                ps[4] -= sub;
                ps[5] -= sub;
                return {points:ps,span:spanDeg};
            },

            drawDiscs: function() {
                var r = this.radius, th = 1;
                for (var i=0; i < 180;i++) {
                    th = i%5==0? 3 : 1;
                    this.snap.line(r, 0, r, (r*2)).attr({
                        "stroke":"black",
                        "stroke-width": th +"px",
                        "transform-origin": "0 0",
                        transform: "rotate("+i+"deg)"
                    });
                }
                this.snap.circle(r,r,(r * 0.75 )).attr({fill:'#110066'});
            },

            housesToSegments: function() {
                var cls = ['#ff0000','#999900','#00ff00','#009999','#0000ff','#990099'];
                this.loopHouses('init',cls);

            },

            loopHouses: function(mode,fillColours) {
                var endHouse = this.houses[0];
                if (endHouse <= 0) {
                    endHouse = 360 - endHouse;
                }
                this.houses.push(endHouse);
                console.log(this.houses)
                var index=0,start, end;
                for (d in this.houses) {
                    if (start == null) {
                        start = this.houses[d];
                    } else {
                        end = this.houses[d];
                    }
                    if (end != null && start !=null) {
                         if (mode == 'init') {
                            this.addSegment(fillColours[(index%fillColours.length)],start,end,index);
                         } else {
                            if (this.segments.length > index) {
                               this.updateSegment(index,start,end); 
                            }
                         }
                        start = end;
                        end = null;
                        index++;
                    }
                }
            },

            placeBody: function(bodyName,x,y) {
                var r= this.radius, xd = r - ((r * 0.75) * x), yd = r - ((r * 0.75) * y);
                return this.snap.image('/svgs/grahas/glyph/'+bodyName+'-sign.svg',xd,yd,(r/12),(r/12)).attr('class','body ' + bodyName);
            },

            positionBody: function(bodyEl,x,y) {
                var r= this.radius, xd = r - ((r * 0.75) * x), yd = r - ((r * 0.75) * y);
                bodyEl.attr({
                    x: xd,
                    y: yd
                });
            },

            updateBody: function(bodyName,lng,lat) {
                var rd = 180/Math.PI, pos=0.9;
                var mx = Math.cos(lng/rd),
                my = Math.sin(lng/rd),
                pos = Math.abs(lat/6);
                my *= pos;
                mx *= pos;
                if (astroDisc.bodies[bodyName]) {
                    var body = astroDisc.bodies[bodyName];
                    console.log(lng,k,mx,my,pos,lat);
                    astroDisc.positionBody(body,mx,my);
                }
            },

            init: function(radius,houses) {
                this.snap = Snap('#zodiac-svg');
                if (radius) {
                    if (typeof radius == 'number') {
                        this.radius = radius;
                    }
                }
                if (houses) {
                    if (houses instanceof Array) {
                        this.houses = houses;
                    }
                }
                this.housesToSegments();
                this.drawDiscs();
                this.bodies.sun = this.placeBody('sun',0.1,0.-.1);
                this.bodies.moon = this.placeBody('moon',0.6,0.-.6);
                this.bodies.mercury = this.placeBody('mercury',0.25,0.25);
                this.bodies.venus = this.placeBody('venus',0.1,-0.15);
                this.bodies.marse = this.placeBody('mars',0.35,0.15);
                this.bodies.jupiter = this.placeBody('jupiter',0.5,0.5);
                this.bodies.saturn = this.placeBody('saturn',-0.7,0.3);
                this.bodies.neptune = this.placeBody('neptune',-0.4,-0.23);
                var rd = 180/Math.PI, degs=45, pos=.9;
                this.bodies.uranus = astroDisc.placeBody('uranus',Math.sin(degs/rd),Math.cos(45/degs));
                this.snap.path("M720,720L720,0 C60,120 120,120 110,250");
            }
        }

        
        
        astroDisc.init(720);

        $('.plus-minus').on('click',function(e){
            e.stopImmediatePropagation();
            if ($('#snap-pane').hasClass('fit-screen')) {
                $('#snap-pane').removeClass('fit-screen');
                $(this).text('-');
            } else {
                $('#snap-pane').addClass('fit-screen');
                $(this).text('+');
            }
        });
   
    });
})(jQuery);

</script>
<script data-source="internal" type="text/javascript" src="/js/chart.js"></script>
</body>
</html>