//- This version of the Control Form / Panel requires VueJS
//- end of selectrow
include mixins.pug

h2.toggle-aside New Chart
form#control-form(action="/sweph" method="post" v-on:submit.prevent="sendControlForm")
  fieldset.collapsible.open
    +selectrow('chart_type','Type of Chart',chartTypes,false)(class="select-input" v-model="chartType")
    p.name-row.full-span
      input.name(type="text" id="form-name" name="name" size="10" placeholder="Candidate's Name" v-model="candidateName" required="true" minlength="2")
    p.gender-row(:class="{collapsed: !gender.active,expanded: gender.active}")
      input#form-gender-unknown.gender.unknown(type="radio" name="gender" value="unknown" v-model="gender.type")
      label.sub.gender(for="form-gender-unknown" title="Not specified") N/A
      
      input#form-gender-female.gender.female(type="radio" name="gender" value="female" v-model="gender.type")
      label.sub.gender(for="form-gender-female") Female

      input#form-gender-male.gender.male(type="radio" name="gender" value="male" v-model="gender.type")
      label.sub.gender(for="form-gender-male") Male
      
      input#form-gender-other.gender.other(type="radio" name="gender" value="other" v-model="gender.type")
      label.sub.gender(for="form-gender-other") Other
      input.gender-other-type(:class="{hidden: !gender.otherActive}" type="text" maxlength="32" size="16" name="gender_other" id="form-gender-other-type" placeholder="Other gender definition" v-model="gender.otherType")
    div.datetime
      label(for="form-dob") {{dateLabel}}:
      div.dob-field.half-width.first
        input.datebox(type="date" id="form-dob" name="dob" size="10" data-options!="{&quot;mode&quot;:&quot;flipbox&quot;,&quot;useInlineBlind&quot;:true,&quot;useInlineAlign&quot;:&quot;center&quot;,&quot;useImmediate&quot;:&quot;true&quot;}" v-model="dob")
      div.tob-field.half-width.second
        input.datebox(type="time" id="form-tob" name="tob" size="5" data-options!="{&quot;mode&quot;:&quot;timeflipbox&quot;,&quot;useInlineBlind&quot;:true,&quot;useInlineAlign&quot;:&quot;center&quot;,&quot;useImmediate&quot;:&quot;true&quot;}" v-model="tob")
    fieldset#timezone-settings.collapsible.closed
      h3.toggle Time Zone #[em {{timezone.display}}]
      div#tz-settings.full-width
        div.half-width.first
          label(for="form-timezone") UTC offset:
          select.tzoffset(type="number" id="form-tz" name="timezone" v-model="timezone.offset")
            each opt,index in timezone.offsets
              option(value = opt.value)= opt.label
        div.half-width.second
          label(for="form-daylightsavings") Daylight saving:
          select.ds(id="form-ds" name="ds" v-model="timezone.ds")
            each opt,index in timezone.ds_options
              option(value = opt.value)= opt.label
    p.pob-row
      input(type="text" id="form-location" name="location" size="48" value="" placeholder="Place of birth" v-model="location.search" v-on:click="loadMap")
      input#location-finder(type="submit" value="Find" v-on:click.stop.prevent="searchLocation")
      textarea#location-address.location-address.full-width(:class="{collapsed: !location.showAddress, expanded: location.showAddress}" name="location_address" rows="3" cols="40" required="true" minlength="5") {{location.address}}
    div#geo-alt-places(:class="{hidden:!geonames.active}")
      fieldset#alt-places-container.listing.collapsible.closed
        h3.toggle Alternative places #[em ({{geonames.num}})]
        ol.alt-places
          template(v-for="item in geonames.items")
            li(v-on:click="updateMap(item.coords,item.name)") {{item.name}}
    fieldset.coordinates(:class="coordinatesClass")
      p.lat
        label(for="form-lat" title="latitude") Latitude:
        input.degree.latitude(type="text" pattern="[0-9.-]+" id="form-lat" name="lat" size="4" title="latitude" v-model="location.coords.lat")
        span.dms-select.lat
          input.dms.lat.deg(v-model="location.coords.latComponents.deg" size="2" maxlength="2" pattern="[0-9]+")
          span.deg
          input.dms.lat.min(v-model="location.coords.latComponents.min" size="2" maxlength="2" pattern="[0-5]?[0-9]")
          span.min
          input.dms.lat.sec(v-model="location.coords.latComponents.sec" size="5" maxlength="5" pattern="[0-5]?[0-9](\.[0-9]+)?")
          span.sec
          input.dms.lat.dir(v-model="location.coords.latComponents.dir" size="1" maxlength="1" pattern="[NSns]" v-on:click="swapDirection(false)")
        span.coordinates.lat.dms(v-on:click="toggleDegreeMode()") {{location.coords.latDms}}
      p.lng
        label.degree(for="form-lng" title="longitude") Longitude:
        input.degree.longitude(type="text" pattern="[0-9.-]+" id="form-lng" name="lng" size="4" title="longitude" v-model="location.coords.lng")
        span.dms-select.lng
          input.dms.lng.deg(v-model="location.coords.lngComponents.deg" size="3" maxlength="3" pattern="[0-9]+")
          span.deg
          input.dms.lng.min(v-model="location.coords.lngComponents.min" size="2" maxlength="2" pattern="[0-5]?[0-9]")
          span.min
          input.dms.lng.sec(v-model="location.coords.lngComponents.sec" size="5" maxlength="5" pattern="[0-5]?[0-9](\.[0-9]+)?")
          span.sec
          input.dms.lng.dir(v-model="location.coords.lngComponents.dir" size="1" maxlength="1" pattern="[WEwe]" v-on:click="swapDirection(true)")
        span.coordinates.lng.dms(v-on:click="toggleDegreeMode()") {{location.coords.lngDms}}
      p.alt
        label(for="form-alt-display" title="Altitude") Altitude:
        input(type="number" id="form-alt-display" name="alt" size="1" v-bind:steps="location.altSteps" min="0" v-bind:max="location.altMax" title="Height above sea level in metres" v-model="location.altDisplay")
        input(type="hidden" id="form-alt" v-model="location.coords.alt")
        select#form-height-unit.inline(v-model="location.altUnit")
          option(value="m") metres
          option(value="ft") feet
    div#geo-hospitals(:class="{hidden:!hospitals.active}")
      fieldset#hospital-container.listing.collapsible.closed
        h3.toggle Maternity centres #[em ({{hospitals.num}})]
        ol.hospitals
          template(v-for="item in hospitals.items")
            li(:data-coords="item.coords" v-on:click="updateMap(item.coords,item.name)") {{item.name}}
    p.rodden
      label(for="form-rodden" title="Rodden Birth Time Accuracy Scale") Rodden Scale:
      select#form-rodden.select-input(name="rodden" v-model="options.rodden")
        each opt,index in roddenOptions
          option(value = opt.value)= opt.label

    div#form-actions
      input(type="submit" value="Calculate & Save" id="form-submit" )

  //- fieldset.collapsible.closed
  //-   h3.toggle Open Chart
  //-   p Open chart dialog

  fieldset.collapsible.closed
    h3.toggle Calculation Settings
    //- include settings/calc-house-system.pug
    fieldset.collapsible.open
      h4.toggle Default House System
      p.sub-section
        label(for="form-hsy") House system:
        select#form-hsy.select-input(name="hsy" v-model="options.hsy")
          each opt,index in houseSystems
            option(value = opt.value)= opt.label
    //- include settings/calc-ayanamsha.pug
    fieldset.collapsible.open
      h4.toggle Tropical vs. Sidereal (Ayanāṃśa)
      p.sub-section
        label(for="form-ayanamsa") Ayanāṃśa
        select#form-ayanamsa.select-input(name="ayanamsa" v-model="options.ayanamsa")
          each opt,index in ayanamsas
            option(value = opt.value)= opt.label
    //- include settings/calc-celestial.pug
    fieldset.collapsible.open
      h4.toggle Celestial Calculations
      p#form-mode.sub-section.radios
        input#form-mode-topo.mode(type="radio" value="topo" name="mode" v-model="options.mode")
        label(for="form-mode-topo") Topocentric
        input#form-mode-geo.mode(type="radio" value="geo" name="mode" class="mode" v-model="options.mode")
        label(for="form-mode-geo") Geocentric


    fieldset.collapsible.closed
      h4.toggle Solar Year & Lunar Month
      //- include settings/calc-year-solar.pug
      fieldset.collapsible.open
        h5.toggle Astronomical Solar Year
        div.sub-sub-section
          p
            input#form-solar-t.solar(type="radio" value="365.242199" name="solar-t" checked="true" )
            label(for="form-solar-t") Tropical Year
          p
            input#form-solar-s.solar(type="radio" value="365.256366" name="solar-t")
            label(for="form-solar-s") Sidereal Year
          p
            input#form-solar-a.solar(type="radio" value="365.259636" name="solar-t")
            label(for="form-solar-a") Anomalistic year
          div.notes!= solarYearOptionNotes

    //- include settings/calc-year-dasha.pug
    fieldset.collapsible.closed
      h5.toggle Time Period (Daśa) Year Definition
      p
        input(type="radio" value="" name="year-astron" id="form-year-astron" class="solar-dasha" checked="true" )
        label(for="form-year-astron") Astronomical Year (select above)
      p
        input(type="radio" value="365" name="year-calendar" id="form-year-calendar" class="solar-dasha" )
        label(for="form-year-calendar") 365 Calendar Year
      p
        input(type="radio" value="360" name="year-360" id="form-year-360" class="solar-dasha" )
        label(for="form-year-360") 360 Day Year
      p
        input#form-year-solilunar.solar-dasha(type="radio" value="354.36708" name="year-solilunar")
        label(for="form-year-solilunar") Synodic SoliLunar Year
    //- include settings/calc-month-lunar.pug
    fieldset.collapsible.closed
      h5.toggle Astronomical Lunar Month
      p
        input#form-lunar-t.lunar(type="radio" value="27.321582" name="lunar-t")
        label(for="form-solar-t") Tropical month
      p
        input#form-lunar-s.lunar(type="radio" value="27.321662" name="lunar-s")
        label(for="form-solar-s") Sidereal month
      p
        input.lunar(type="radio" value="27.321582" name="lunar-a" id="form-lunar-a" class="" )
        label(for="form-solar-a") Anomalistic month
      p
        input#form-lunar-syn.lunar(type="radio" value="29.5305888531" name="lunar-syn" checked="true")
        label(for="form-solar-syn") Synodic month
      div.notes!= lunarMonthsNoteOptions
        //-sub-sub-section

    //- sub-section
